document.addEventListener("DOMContentLoaded", function() {
var MarkerIcon = L.Icon.extend({
    options: {
        iconSize:     [30, 30],
        iconAnchor:   [15, 15]
    }
});

var boltIcon = new MarkerIcon({iconUrl: 'img/coloured_bolt.png'});
var mymap = L.map('map').setView([53.96, -3.22], 5);

L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
  attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
  maxZoom: 18,
  id: 'mapbox/streets-v11',
  tileSize: 512,
  zoomOffset: -1,
  accessToken: 'pk.eyJ1IjoiZW5lcmd5dmlzIiwiYSI6ImNrbjR2aWo4azBsaHEycHM5dHByZzFnZW8ifQ.MyLCIQqHnNHQFWJQqs-j4w'
}).addTo(mymap);

var geojsonFeature = {'type': 'FeatureCollection', 'features': [{'type': 'Feature', 'properties': {'description': 'A fault occurred on a piece of our electrical equipment which controls the power to your home.', 'dno': 'ukpn', 'estimated_restored_time': '2021-04-18T08:00:00', 'incident_id': 'INCD-231615-Z', 'incident_url': 'https://www.ukpowernetworks.co.uk/power-cut/map?incidentid=INCD-231615-Z', 'postcodes_impacted': ['CM40JX', 'CM40JY'], 'received_time': '2021-04-18T03:23:00'}, 'geometry': {'type': 'Point', 'coordinates': [0.2929238966132422, 51.692880187824095]}}, {'type': 'Feature', 'properties': {'description': "We're carrying out planned work in your area. For our engineers to carry it out safely they need to turn the power off. We're doing this work as it's essential to provide reliable electricity supplies to your area. We're sorry for any inconvenience caused and thank you for your patience.", 'dno': 'ukpn', 'estimated_restored_time': '2021-04-18T15:30:00', 'incident_id': 'INCD-227958-Z', 'incident_url': 'https://www.ukpowernetworks.co.uk/power-cut/map?incidentid=INCD-227958-Z', 'postcodes_impacted': ['CB51SA', 'CB61SA', 'CB61SB', 'CB61SE', 'CB61SG', 'CB64QW', 'CB74QW'], 'received_time': '2021-04-18T08:30:00'}, 'geometry': {'type': 'Point', 'coordinates': [0.2764796588146815, 52.428463015294675]}}, {'type': 'Feature', 'properties': {'description': "We're carrying out planned work in your area. For our engineers to carry it out safely they need to turn the power off. We're doing this work as it's essential to provide reliable electricity supplies to your area. We're sorry for any inconvenience caused and thank you for your patience.", 'dno': 'ukpn', 'estimated_restored_time': '2021-04-18T15:30:00', 'incident_id': 'INCD-218127-Z', 'incident_url': 'https://www.ukpowernetworks.co.uk/power-cut/map?incidentid=INCD-218127-Z', 'postcodes_impacted': ['CB40FB', 'CB40GN', 'CB40WE', 'CB44BH', 'CB44WE'], 'received_time': '2021-04-18T08:30:00'}, 'geometry': {'type': 'Point', 'coordinates': [0.1483293076776418, 52.23539636016507]}}, {'type': 'Feature', 'properties': {'description': 'We&#39;re carrying out planned work in your area. For our engineers to carry it out safely they need to turn the power off. We&#39;re doing this work as it&#39;s essential to provide reliable electricity supplies to your area. We&#39;re sorry for any inconvenience caused and thank you for your patience.', 'dno': 'ukpn', 'estimated_restored_time': '2021-04-18T12:00:00', 'incident_id': 'INCD-228076-Z', 'incident_url': 'https://www.ukpowernetworks.co.uk/power-cut/map?incidentid=INCD-228076-Z', 'postcodes_impacted': ['IP145NR', 'IP146BH', 'IP146JT', 'IP146JZ', 'IP146LA', 'IP146LB', 'IP146NF', 'IP146QP', 'IP146QR', 'IP146QS', 'IP146QU', 'IP146QW', 'IP146RW', 'IP146SR', 'IP146ST'], 'received_time': '2021-04-18T09:00:00'}, 'geometry': {'type': 'Point', 'coordinates': [1.182571413009092, 52.2258367299417]}}, {'type': 'Feature', 'properties': {'description': 'We&#39;re carrying out planned work in your area. For our engineers to carry it out safely they need to turn the power off. We&#39;re doing this work as it&#39;s essential to provide reliable electricity supplies to your area. We&#39;re sorry for any inconvenience caused and thank you for your patience.', 'dno': 'ukpn', 'estimated_restored_time': '2021-04-18T12:00:00', 'incident_id': 'INCD-227426-Z', 'incident_url': 'https://www.ukpowernetworks.co.uk/power-cut/map?incidentid=INCD-227426-Z', 'postcodes_impacted': ['NR128AH', 'NR128AN', 'NR128ES', 'NR128ET', 'NR128EU', 'NR128EY'], 'received_time': '2021-04-18T10:00:00'}, 'geometry': {'type': 'Point', 'coordinates': [1.3938054734244327, 52.74779974912337]}}, {'type': 'Feature', 'properties': {'description': "We're carrying out planned work in your area. For our engineers to carry it out safely they need to turn the power off. We're doing this work as it's essential to provide reliable electricity supplies to your area. We're sorry for any inconvenience caused and thank you for your patience.", 'dno': 'ukpn', 'estimated_restored_time': '2021-04-18T16:30:00', 'incident_id': 'INCD-229979-Z', 'incident_url': 'https://www.ukpowernetworks.co.uk/power-cut/map?incidentid=INCD-229979-Z', 'postcodes_impacted': ['MK410HT', 'MK410JW', 'MK410LF', 'MK410QQ'], 'received_time': '2021-04-18T08:30:00'}, 'geometry': {'type': 'Point', 'coordinates': [-0.4130208762534288, 52.14851199913749]}}, {'type': 'Feature', 'properties': {'description': 'We’re sorry for the loss of supply. We currently have a fault affecting the areas listed. Our engineers are on site working hard to get the power back on as quickly as they can. If you need more information, please call us on 105 or send us a message on <a href="http://m.me/ssencommunity/">Facebook</a> or Twitter (<a href="https://twitter.com/ssencommunity">@ssencommunity</a>) and quote reference \'HB8332\'', 'dno': 'ssen', 'estimated_restored_time': '2021-04-18 07:30:00', 'incident_id': 'HB8332', 'incident_url': 'https://www.ssen.co.uk/Powertrack/', 'postcodes_impacted': ['SL6 4EP', 'SL6 4ER', 'SL6 4ES', 'SL6 4ET', 'SL6 6DA', 'SL6 6DD', 'SL6 6DE', 'SL6 6DG', 'SL6 6DJ'], 'received_time': '2021-04-18 03:25:00'}, 'geometry': {'type': 'Point', 'coordinates': [-0.7337617777777777, 51.52218055555555]}}, {'type': 'Feature', 'properties': {'description': 'In Progress', 'dno': 'wpd', 'estimated_restored_time': '2021-04-18 11:30:00', 'incident_id': 'INCD-358031-G', 'incident_url': 'https://powercuts.westernpower.co.uk/incident/INCD-358031-G', 'postcodes_impacted': ['DY9 9ST', 'DY9 9SU'], 'received_time': '2021-04-18 00:23:00'}, 'geometry': {'type': 'Point', 'coordinates': [-2.1176125, 52.392997]}}, {'type': 'Feature', 'properties': {'description': 'In Progress', 'dno': 'wpd', 'estimated_restored_time': '2021-04-18 07:00:00', 'incident_id': 'INCD-152800-H', 'incident_url': 'https://powercuts.westernpower.co.uk/incident/INCD-152800-H', 'postcodes_impacted': ['DE56 2UN', 'DE56 2US', 'DE56 1UU', 'DE56 2UW'], 'received_time': '2021-04-18 02:43:00'}, 'geometry': {'type': 'Point', 'coordinates': [-1.4900102499999999, 53.01668574999999]}}, {'type': 'Feature', 'properties': {'description': 'There is a power cut affecting the LL68 postcode area of Amlwch. We had no advance warning of this and only became aware of it at 5:46am. Our control centre will attempt to reset the network remotely to restore power in stages, and we will also send our next available engineer to attend site. Our team will work to get your power back on as quickly and as safely as possible by 8am. Once they arrive, or when we receive any update regarding the cause, we will be able to provide you with more information. We apologise for the inconvenience and thank you for your patience. This message was updated at 5:50am on 18th April', 'dno': 'sp', 'estimated_restored_time': '2021-04-18 06:46', 'incident_id': 'INCD-564775-s', 'incident_url': 'https://www.spenergynetworks.co.uk/pages/power_cuts_map.aspx?incRef=INCD-564775-s', 'postcodes_impacted': ['LL609ET', 'LL68', 'LL689AB', 'LL689AH', 'LL689AL', 'LL689AN', 'LL689AP', 'LL689BA', 'LL689DL', 'LL689DN', 'LL689DP', 'LL689DS', 'LL689DT', 'LL689DU', 'LL689DW', 'LL689DY', 'LL689EA', 'LL689ED', 'LL689EH', 'LL689EJ', 'LL689EL', 'LL689EN', 'LL689EP', 'LL689EQ', 'LL689ER', 'LL689ES', 'LL689ET', 'LL689EW', 'LL689EY', 'LL689HA', 'LL689LH', 'LL689TG', 'LL689XX', 'LL699DU'], 'received_time': '2021-04-18 05:46'}, 'geometry': {'type': 'Point', 'coordinates': [-4.343841154826771, 53.41106307231364]}}, {'type': 'Feature', 'properties': {'description': 'We are aware of a fault in your area. If you require more information please call us on: \nCentral and Southern Scotland:  0800 092 9290 . \n Cheshire, Merseyside, North Wales and North Shropshire: 0800 001 5400.', 'dno': 'sp', 'estimated_restored_time': '2021-04-18 06:01', 'incident_id': 'INCD-1809404-i', 'incident_url': 'https://www.spenergynetworks.co.uk/pages/power_cuts_map.aspx?incRef=INCD-1809404-i', 'postcodes_impacted': ['WA46NE', 'WA46NX', 'WA46NY', 'WA46NZ', 'WA46PA', 'WA46PB', 'WA46PF', 'WA46PG', 'WA46PH'], 'received_time': '2021-04-18 03:31'}, 'geometry': {'type': 'Point', 'coordinates': [-2.5924845736481954, 53.3671338591081]}}, {'type': 'Feature', 'properties': {'description': 'Smart Meter Cutout Change In Progress', 'dno': 'np', 'estimated_restored_time': '', 'incident_id': 'INCD-17176-D', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'LS9 9JZ': {'class': 'models.MapDataLocation', 'lat': 53.7936, 'lng': -1.514}}, 'received_time': '2021-04-17 11:12'}, 'geometry': {'type': 'Point', 'coordinates': [-1.513938, 53.79355]}}, {'type': 'Feature', 'properties': {'description': 'DNO Energisation check Awaiting', 'dno': 'np', 'estimated_restored_time': '', 'incident_id': 'INCD-172393-A', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'S2 1JW': {'class': 'models.MapDataLocation', 'lat': 53.3651, 'lng': -1.42538}}, 'received_time': '2021-04-18 01:49'}, 'geometry': {'type': 'Point', 'coordinates': [-1.425446, 53.364924]}}, {'type': 'Feature', 'properties': {'description': 'Unknown P2 Awaiting', 'dno': 'np', 'estimated_restored_time': '2021-04-18 07:30', 'incident_id': 'INCD-172403-A', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'BD4 9HG': {'class': 'models.MapDataLocation', 'lat': 53.7821, 'lng': -1.71133}}, 'received_time': '2021-04-18 04:19'}, 'geometry': {'type': 'Point', 'coordinates': [-1.71133, 53.782072]}}, {'type': 'Feature', 'properties': {'description': 'We need to temporarily turn the power off to carry out maintenance on our network in the area. The scheduled work has been cancelled and is no longer taking place today', 'dno': 'np', 'estimated_restored_time': '2021-04-18 22:00', 'incident_id': 'PPC039363', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'DN41 8DW': {'class': 'models.MapDataLocation', 'lat': 53.6083, 'lng': -0.172296}, 'DN41 8DL': {'class': 'models.MapDataLocation', 'lat': 53.6088, 'lng': -0.171807}, 'DN41 8FD': {'class': 'models.MapDataLocation', 'lat': 53.6065, 'lng': -0.180157}, 'DN4 5NU': {'class': 'models.MapDataLocation', 'lat': 53.5082, 'lng': -1.12161}, 'DN41 8TH': {'class': 'models.MapDataLocation', 'lat': 53.6052, 'lng': -0.181212}}, 'received_time': '2021-04-18 17:00'}, 'geometry': {'type': 'Point', 'coordinates': [-0.36565339999999996, 53.587383]}}, {'type': 'Feature', 'properties': {'description': 'We need to temporarily turn the power off to carry out replacement of poles that support our overhead power lines in the area. Work is scheduled to start', 'dno': 'np', 'estimated_restored_time': '2021-04-18 14:30', 'incident_id': 'PPC039606', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'HX3 9TF': {'class': 'models.MapDataLocation', 'lat': 53.7177, 'lng': -1.82668}}, 'received_time': '2021-04-18 08:30'}, 'geometry': {'type': 'Point', 'coordinates': [-1.826674, 53.717724]}}, {'type': 'Feature', 'properties': {'description': 'We need to temporarily turn the power off to carry out replacement work on our overhead power lines in the area. Work is scheduled to start', 'dno': 'np', 'estimated_restored_time': '2021-04-18 14:00', 'incident_id': 'PPC039748', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'NE47 7HE': {'class': 'models.MapDataLocation', 'lat': 54.9894, 'lng': -2.39113}, 'NE47 7AW': {'class': 'models.MapDataLocation', 'lat': 55.0007, 'lng': -2.38799}, 'NE47 7JW': {'class': 'models.MapDataLocation', 'lat': 54.9907, 'lng': -2.3735}, 'NE47 7AL': {'class': 'models.MapDataLocation', 'lat': 54.9974, 'lng': -2.37973}, 'NE47 7AN': {'class': 'models.MapDataLocation', 'lat': 54.9955, 'lng': -2.39183}}, 'received_time': '2021-04-18 08:00'}, 'geometry': {'type': 'Point', 'coordinates': [-2.3842884, 54.99502739999999]}}, {'type': 'Feature', 'properties': {'description': 'We need to temporarily turn the power off to carry out replacement work at a substation in the area. Work is scheduled to start', 'dno': 'np', 'estimated_restored_time': '2021-04-18 14:00', 'incident_id': 'PPC039968', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'NE47 7HD': {'class': 'models.MapDataLocation', 'lat': 54.9868, 'lng': -2.37724}}, 'received_time': '2021-04-18 07:30'}, 'geometry': {'type': 'Point', 'coordinates': [-2.377239, 54.986748]}}, {'type': 'Feature', 'properties': {'description': 'The power cut in your area has been caused by an unexpected incident with the underground cable that provides electricity to your property.', 'dno': 'enw', 'estimated_restored_time': '2021-04-18 12:30', 'incident_id': '60508633', 'incident_url': 'https://www.enwl.co.uk/power-cuts/power-cuts-power-cuts-live-power-cut-information-fault-list/fault-list', 'postcodes_impacted': ['LA3 2BP', 'LA3 2BU', 'LA3 2DF', 'LA3 2DN', 'LA3 2DQ', 'LA3 2DR', 'LA3 2DS', 'LA3 2DY', 'LA3 2JH'], 'received_time': '2021-04-17 16:41'}, 'geometry': {'type': 'Point', 'coordinates': [-2.890340777777778, 54.048605888888886]}}]}

var geoJson = new L.geoJSON(geojsonFeature, {
  onEachFeature: function (feature, layer) {
    layer.bindPopup('<p>'+feature.properties.description+'</p><p>Received time: '+feature.properties.received_time+'</p><p>Estimated restored time: '+feature.properties.estimated_restored_time+'</p><p><a href="'+feature.properties.incident_url+'" target="_blank">Further details</p>');
    layer.setIcon(boltIcon);
  }
}).addTo(mymap);
});