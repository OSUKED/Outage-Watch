document.addEventListener("DOMContentLoaded", function() {
var MarkerIcon = L.Icon.extend({
    options: {
        iconSize:     [30, 30],
        iconAnchor:   [15, 15]
    }
});

var boltIcon = new MarkerIcon({iconUrl: 'img/coloured_bolt.png'});
var mymap = L.map('map').setView([53.96, -3.22], 5);

L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
  attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
  maxZoom: 18,
  id: 'mapbox/streets-v11',
  tileSize: 512,
  zoomOffset: -1,
  accessToken: 'pk.eyJ1IjoiZW5lcmd5dmlzIiwiYSI6ImNrbjR2aWo4azBsaHEycHM5dHByZzFnZW8ifQ.MyLCIQqHnNHQFWJQqs-j4w'
}).addTo(mymap);

var geojsonFeature = {'type': 'FeatureCollection', 'features': [{'type': 'Feature', 'properties': {'description': 'An underground electricity cable faulted on our high voltage network, causing an area wide power cut.', 'dno': 'ukpn', 'estimated_restored_time': '2021-04-18T01:00:00', 'incident_id': 'INCD-231546-Z', 'incident_url': 'https://www.ukpowernetworks.co.uk/power-cut/map?incidentid=INCD-231546-Z', 'postcodes_impacted': ['CM150LD', 'CM150LE', 'CM150EH', 'CM150EJ', 'CM150EL', 'CM150EN', 'CM150EP', 'CM150EQ', 'CM150ER', 'CM150ES', 'CM150ET', 'CM150EW', 'CM150JX', 'CM150LG', 'CM150NA', 'CM150PU', 'CM150QE', 'CM150QZ', 'CM150RE', 'CM150RU', 'CM150SB', 'CM150SE', 'CM150SF', 'CM150SG', 'CM150SH', 'CM150SJ', 'CM150SL', 'CM150SN', 'CM150SP', 'CM150SR', 'CM150SS', 'CM150ST', 'CM150SU', 'CM150TS', 'CM150TT', 'CM150TU', 'CM35QH', 'CM40JR', 'CM40JS', 'CM40JU', 'CM40JX', 'CM40JY', 'CM40JZ', 'CM40NW', 'CM40NX', 'CM40NZ', 'CM40PA', 'CM40QE', 'CM40QH', 'CM40QJ', 'CM40QL', 'CM40QN', 'CM40QP', 'CM40QR', 'CM40QU', 'CM40QW', 'CM40QX', 'CM40QY', 'CM40QZ', 'CM40RA', 'CM40RB', 'CM40RD', 'CM40RJ', 'CM40RL', 'CM40RN', 'CM40RR', 'CM40RS', 'CM40RT', 'CM40RU', 'CM40RX', 'CM40RY', 'CM40RZ', 'CM40SA', 'CM40SB', 'CM40SD', 'CM40SF', 'CM40SG', 'CM40SP', 'CM59RG'], 'received_time': '2021-04-17T09:30:03'}, 'geometry': {'type': 'Point', 'coordinates': [0.3140477013504482, 51.67978289628871]}}, {'type': 'Feature', 'properties': {'description': 'We’re sorry for the loss of supply. We currently have a fault affecting the areas listed. Our engineers are on site working hard to get the power back on as quickly as they can. If you need more information, please call us on 105 or send us a message on <a href="http://m.me/ssencommunity/">Facebook</a> or Twitter (<a href="https://twitter.com/ssencommunity">@ssencommunity</a>) and quote reference \'HB8321\'', 'dno': 'ssen', 'estimated_restored_time': '2021-04-18 04:05:00', 'incident_id': 'HB8321', 'incident_url': 'https://www.ssen.co.uk/Powertrack/', 'postcodes_impacted': ['TW13 6HB', 'TW13 6HD', 'TW13 6HF', 'TW13 6JA', 'TW13 6JB', 'TW13 6LE'], 'received_time': '2021-04-18 00:54:00'}, 'geometry': {'type': 'Point', 'coordinates': [-0.37676099999999996, 51.436045500000006]}}, {'type': 'Feature', 'properties': {'description': 'We’re sorry for the loss of supply. We currently have a fault affecting the areas listed. Our engineers are on site working hard to get the power back on as quickly as they can. If you need more information, please call us on 105 or send us a message on <a href="http://m.me/ssencommunity/">Facebook</a> or Twitter (<a href="https://twitter.com/ssencommunity">@ssencommunity</a>) and quote reference \'HB8319\'', 'dno': 'ssen', 'estimated_restored_time': '2021-04-18 03:30:00', 'incident_id': 'HB8319', 'incident_url': 'https://www.ssen.co.uk/Powertrack/', 'postcodes_impacted': ['DD8 5DH', 'DD8 5DJ', 'DD8 5DN', 'DD8 5DS'], 'received_time': '2021-04-18 00:28:00'}, 'geometry': {'type': 'Point', 'coordinates': [-3.0070069999999998, 56.66787825]}}, {'type': 'Feature', 'properties': {'description': 'In Progress', 'dno': 'wpd', 'estimated_restored_time': '2021-04-18 02:00:00', 'incident_id': 'INCD-67-q', 'incident_url': 'https://powercuts.westernpower.co.uk/incident/INCD-67-q', 'postcodes_impacted': ['EX10 9NQ', 'EX10 9AS', 'EX10 9AR', 'EX10 9AP', 'EX10 9AG', 'EX10 9NS', 'EX10 9AA'], 'received_time': '2021-04-17 19:02:00'}, 'geometry': {'type': 'Point', 'coordinates': [-3.2304158571428565, 50.686792714285716]}}, {'type': 'Feature', 'properties': {'description': 'The electricity supply to your premises may currently be affected by planned work.  You should have received a letter explaining this.  We hope to be able to restore your supplies by 18-APR-2021 08:00.  Please accept our sincere apologies for any inconvenience this is causing.', 'dno': 'sp', 'estimated_restored_time': '2021-04-18 07:00', 'incident_id': 'INCD-494579-k', 'incident_url': 'https://www.spenergynetworks.co.uk/pages/power_cuts_map.aspx?incRef=INCD-494579-k', 'postcodes_impacted': ['FK28QX', 'FK28XX'], 'received_time': '2021-04-02 10:05'}, 'geometry': {'type': 'Point', 'coordinates': [-3.79198947265032, 56.04415359395529]}}, {'type': 'Feature', 'properties': {'description': 'Smart Meter Cutout Change In Progress', 'dno': 'np', 'estimated_restored_time': '', 'incident_id': 'INCD-17176-D', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'LS9 9JZ': {'class': 'models.MapDataLocation', 'lat': 53.7936, 'lng': -1.514}}, 'received_time': '2021-04-17 11:12'}, 'geometry': {'type': 'Point', 'coordinates': [-1.513938, 53.79355]}}, {'type': 'Feature', 'properties': {'description': 'U/G Service repair In Progress', 'dno': 'np', 'estimated_restored_time': '', 'incident_id': 'INCD-172369-A', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'HX3 0AS': {'class': 'models.MapDataLocation', 'lat': 53.7085, 'lng': -1.85801}}, 'received_time': '2021-04-17 18:02'}, 'geometry': {'type': 'Point', 'coordinates': [-1.858011, 53.708507]}}, {'type': 'Feature', 'properties': {'description': 'Unknown P2 Awaiting', 'dno': 'np', 'estimated_restored_time': '2021-04-18 01:15', 'incident_id': 'INCD-172384-A', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'YO21 3SR': {'class': 'models.MapDataLocation', 'lat': 54.4928, 'lng': -0.654637}}, 'received_time': '2021-04-17 22:08'}, 'geometry': {'type': 'Point', 'coordinates': [-0.654671, 54.492682]}}, {'type': 'Feature', 'properties': {'description': 'Unknown P1 Awaiting', 'dno': 'np', 'estimated_restored_time': '2021-04-18 04:15', 'incident_id': 'INCD-172391-A', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'S6 5HN': {'class': 'models.MapDataLocation', 'lat': 53.3966, 'lng': -1.52415}}, 'received_time': '2021-04-18 01:04'}, 'geometry': {'type': 'Point', 'coordinates': [-1.525236, 53.396777]}}, {'type': 'Feature', 'properties': {'description': 'We need to temporarily turn the power off to carry out maintenance on our network in the area. The scheduled work has been cancelled and is no longer taking place today', 'dno': 'np', 'estimated_restored_time': '2021-04-18 22:00', 'incident_id': 'PPC039363', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'DN41 8DW': {'class': 'models.MapDataLocation', 'lat': 53.6083, 'lng': -0.172296}, 'DN41 8DL': {'class': 'models.MapDataLocation', 'lat': 53.6088, 'lng': -0.171807}, 'DN41 8FD': {'class': 'models.MapDataLocation', 'lat': 53.6065, 'lng': -0.180157}, 'DN4 5NU': {'class': 'models.MapDataLocation', 'lat': 53.5082, 'lng': -1.12161}, 'DN41 8TH': {'class': 'models.MapDataLocation', 'lat': 53.6052, 'lng': -0.181212}}, 'received_time': '2021-04-18 17:00'}, 'geometry': {'type': 'Point', 'coordinates': [-0.36565339999999996, 53.587383]}}, {'type': 'Feature', 'properties': {'description': 'We need to temporarily turn the power off to carry out replacement of poles that support our overhead power lines in the area. Work is scheduled to start', 'dno': 'np', 'estimated_restored_time': '2021-04-18 14:30', 'incident_id': 'PPC039606', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'HX3 9TF': {'class': 'models.MapDataLocation', 'lat': 53.7177, 'lng': -1.82668}}, 'received_time': '2021-04-18 08:30'}, 'geometry': {'type': 'Point', 'coordinates': [-1.826674, 53.717724]}}, {'type': 'Feature', 'properties': {'description': 'We need to temporarily turn the power off to carry out replacement work on our overhead power lines in the area. Work is scheduled to start', 'dno': 'np', 'estimated_restored_time': '2021-04-18 14:00', 'incident_id': 'PPC039748', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'NE47 7HE': {'class': 'models.MapDataLocation', 'lat': 54.9894, 'lng': -2.39113}, 'NE47 7AW': {'class': 'models.MapDataLocation', 'lat': 55.0007, 'lng': -2.38799}, 'NE47 7JW': {'class': 'models.MapDataLocation', 'lat': 54.9907, 'lng': -2.3735}, 'NE47 7AL': {'class': 'models.MapDataLocation', 'lat': 54.9974, 'lng': -2.37973}, 'NE47 7AN': {'class': 'models.MapDataLocation', 'lat': 54.9955, 'lng': -2.39183}}, 'received_time': '2021-04-18 08:00'}, 'geometry': {'type': 'Point', 'coordinates': [-2.3842884, 54.99502739999999]}}, {'type': 'Feature', 'properties': {'description': 'We need to temporarily turn the power off to carry out replacement work at a substation in the area. Work is scheduled to start', 'dno': 'np', 'estimated_restored_time': '2021-04-18 14:00', 'incident_id': 'PPC039968', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'NE47 7HD': {'class': 'models.MapDataLocation', 'lat': 54.9868, 'lng': -2.37724}}, 'received_time': '2021-04-18 07:30'}, 'geometry': {'type': 'Point', 'coordinates': [-2.377239, 54.986748]}}, {'type': 'Feature', 'properties': {'description': 'The power cut in your area has been caused by an unexpected incident with the underground cable that provides electricity to your property.', 'dno': 'enw', 'estimated_restored_time': '2021-04-18 06:13', 'incident_id': '60508662', 'incident_url': 'https://www.enwl.co.uk/power-cuts/power-cuts-power-cuts-live-power-cut-information-fault-list/fault-list', 'postcodes_impacted': ['LA6 1LH', 'LA6 1LN', 'LA6 1LT', 'LA6 1LX'], 'received_time': '2021-04-18 00:12'}, 'geometry': {'type': 'Point', 'coordinates': [-2.72113425, 54.1808295]}}, {'type': 'Feature', 'properties': {'description': 'The power cut in your area has been caused by an unexpected incident with the underground cable that provides electricity to your property.', 'dno': 'enw', 'estimated_restored_time': '2021-04-18 12:30', 'incident_id': '60508633', 'incident_url': 'https://www.enwl.co.uk/power-cuts/power-cuts-power-cuts-live-power-cut-information-fault-list/fault-list', 'postcodes_impacted': ['LA3 2BP', 'LA3 2BU', 'LA3 2DF', 'LA3 2DN', 'LA3 2DQ', 'LA3 2DR', 'LA3 2DS', 'LA3 2DY', 'LA3 2JH'], 'received_time': '2021-04-17 16:41'}, 'geometry': {'type': 'Point', 'coordinates': [-2.890340777777778, 54.048605888888886]}}]}

var geoJson = new L.geoJSON(geojsonFeature, {
  onEachFeature: function (feature, layer) {
    layer.bindPopup('<p>'+feature.properties.description+'</p><p>Received time: '+feature.properties.received_time+'</p><p>Estimated restored time: '+feature.properties.estimated_restored_time+'</p><p><a href="'+feature.properties.incident_url+'" target="_blank">Further details</p>');
    layer.setIcon(boltIcon);
  }
}).addTo(mymap);
});