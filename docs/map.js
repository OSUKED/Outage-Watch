document.addEventListener("DOMContentLoaded", function() {
var MarkerIcon = L.Icon.extend({
    options: {
        iconSize:     [30, 30],
        iconAnchor:   [15, 15]
    }
});

var boltIcon = new MarkerIcon({iconUrl: 'img/coloured_bolt.png'});
var mymap = L.map('map').setView([53.96, -3.22], 5);

L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
  attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
  maxZoom: 18,
  id: 'mapbox/streets-v11',
  tileSize: 512,
  zoomOffset: -1,
  accessToken: 'pk.eyJ1IjoiZW5lcmd5dmlzIiwiYSI6ImNrbjR2aWo4azBsaHEycHM5dHByZzFnZW8ifQ.MyLCIQqHnNHQFWJQqs-j4w'
}).addTo(mymap);

var geojsonFeature = {'type': 'FeatureCollection', 'features': [{'type': 'Feature', 'properties': {'description': 'A fault occurred on a piece of our electrical equipment which controls the power to your home.', 'dno': 'ukpn', 'estimated_restored_time': '2021-04-18T06:30:00', 'incident_id': 'INCD-231615-Z', 'incident_url': 'https://www.ukpowernetworks.co.uk/power-cut/map?incidentid=INCD-231615-Z', 'postcodes_impacted': ['CM40JX', 'CM40JY'], 'received_time': '2021-04-18T03:37:02'}, 'geometry': {'type': 'Point', 'coordinates': [0.2929238966132422, 51.692880187824095]}}, {'type': 'Feature', 'properties': {'description': 'We’re sorry for the loss of supply. We currently have a fault affecting the areas listed. Our engineers are on site working hard to get the power back on as quickly as they can. If you need more information, please call us on 105 or send us a message on <a href="http://m.me/ssencommunity/">Facebook</a> or Twitter (<a href="https://twitter.com/ssencommunity">@ssencommunity</a>) and quote reference \'HB8325\'', 'dno': 'ssen', 'estimated_restored_time': '2021-04-18 05:50:00', 'incident_id': 'HB8325', 'incident_url': 'https://www.ssen.co.uk/Powertrack/', 'postcodes_impacted': ['PO11 9BA', 'PO11 9BD', 'PO11 9ED', 'PO11 9EH', 'PO11 9ET'], 'received_time': '2021-04-18 02:08:00'}, 'geometry': {'type': 'Point', 'coordinates': [-0.9778204, 50.791370799999996]}}, {'type': 'Feature', 'properties': {'description': 'We’re sorry for the loss of supply. We currently have a fault affecting the areas listed. Our engineers are on site working hard to get the power back on as quickly as they can. If you need more information, please call us on 105 or send us a message on <a href="http://m.me/ssencommunity/">Facebook</a> or Twitter (<a href="https://twitter.com/ssencommunity">@ssencommunity</a>) and quote reference \'HB8319\'', 'dno': 'ssen', 'estimated_restored_time': '2021-04-18 03:30:00', 'incident_id': 'HB8319', 'incident_url': 'https://www.ssen.co.uk/Powertrack/', 'postcodes_impacted': ['DD8 5DH', 'DD8 5DJ', 'DD8 5DN', 'DD8 5DS'], 'received_time': '2021-04-18 00:28:00'}, 'geometry': {'type': 'Point', 'coordinates': [-3.0070069999999998, 56.66787825]}}, {'type': 'Feature', 'properties': {'description': 'In Progress', 'dno': 'wpd', 'estimated_restored_time': '2021-04-18 04:30:00', 'incident_id': 'INCD-358031-G', 'incident_url': 'https://powercuts.westernpower.co.uk/incident/INCD-358031-G', 'postcodes_impacted': ['DY9 9ST', 'DY9 9SX', 'DY9 9SU', 'DY9 9TG', 'DY9 9SY', 'DY9 9II'], 'received_time': '2021-04-18 00:23:00'}, 'geometry': {'type': 'Point', 'coordinates': [-2.1179636000000004, 52.3923232]}}, {'type': 'Feature', 'properties': {'description': 'In Progress', 'dno': 'wpd', 'estimated_restored_time': '2021-04-18 04:30:00', 'incident_id': 'INCD-152799-H', 'incident_url': 'https://powercuts.westernpower.co.uk/incident/INCD-152799-H', 'postcodes_impacted': ['NG31 9RH', 'NG31 9QD', 'NG31 9QB', 'NG31 9RQ'], 'received_time': '2021-04-18 01:32:00'}, 'geometry': {'type': 'Point', 'coordinates': [-0.623308, 52.9237705]}}, {'type': 'Feature', 'properties': {'description': 'Awaiting', 'dno': 'wpd', 'estimated_restored_time': '2021-04-18 04:00:00', 'incident_id': 'INCD-152800-H', 'incident_url': 'https://powercuts.westernpower.co.uk/incident/INCD-152800-H', 'postcodes_impacted': ['DE56 1TZ', 'DE56 1AR', 'DE56 1AP', 'DE56 1SX', 'DE56 1SU', 'DE56 1AB', 'DE56 1PW', 'DE56 1SY', 'DE56 2UN', 'DE56 1US', 'DE56 1UT', 'DE56 1SG', 'DE56 1UQ', 'DE56 1PS', 'DE56 1UU', 'DE56 1WN', 'DE56 1AY', 'DE56 1YA', 'DE56 1PP', 'DE56 2GE', 'DE56 1UW', 'DE56 1WH', 'DE56 2UW', 'DE56 1PX', 'DE56 0NG', 'DE56 1PU', 'DE56 2US'], 'received_time': '2021-04-18 02:43:00'}, 'geometry': {'type': 'Point', 'coordinates': [-1.483511, 53.021316629629624]}}, {'type': 'Feature', 'properties': {'description': 'We are aware of a fault in your area. If you require more information please call us on: \nCentral and Southern Scotland:  0800 092 9290 . \n Cheshire, Merseyside, North Wales and North Shropshire: 0800 001 5400.', 'dno': 'sp', 'estimated_restored_time': '2021-04-18 06:01', 'incident_id': 'INCD-1809404-i', 'incident_url': 'https://www.spenergynetworks.co.uk/pages/power_cuts_map.aspx?incRef=INCD-1809404-i', 'postcodes_impacted': ['WA46NE', 'WA46NX', 'WA46NY', 'WA46NZ', 'WA46PA', 'WA46PB', 'WA46PF', 'WA46PG', 'WA46PH'], 'received_time': '2021-04-18 03:31'}, 'geometry': {'type': 'Point', 'coordinates': [-2.5924845736481954, 53.3671338591081]}}, {'type': 'Feature', 'properties': {'description': 'Smart Meter Cutout Change In Progress', 'dno': 'np', 'estimated_restored_time': '', 'incident_id': 'INCD-17176-D', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'LS9 9JZ': {'class': 'models.MapDataLocation', 'lat': 53.7936, 'lng': -1.514}}, 'received_time': '2021-04-17 11:12'}, 'geometry': {'type': 'Point', 'coordinates': [-1.513938, 53.79355]}}, {'type': 'Feature', 'properties': {'description': 'U/G Service repair In Progress', 'dno': 'np', 'estimated_restored_time': '', 'incident_id': 'INCD-172369-A', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'HX3 0AS': {'class': 'models.MapDataLocation', 'lat': 53.7085, 'lng': -1.85801}}, 'received_time': '2021-04-17 18:02'}, 'geometry': {'type': 'Point', 'coordinates': [-1.858011, 53.708507]}}, {'type': 'Feature', 'properties': {'description': 'Unknown P1 In Progress', 'dno': 'np', 'estimated_restored_time': '2021-04-18 04:15', 'incident_id': 'INCD-172391-A', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'S6 5HN': {'class': 'models.MapDataLocation', 'lat': 53.3966, 'lng': -1.52415}}, 'received_time': '2021-04-18 01:04'}, 'geometry': {'type': 'Point', 'coordinates': [-1.525236, 53.396777]}}, {'type': 'Feature', 'properties': {'description': 'U/G Service repair In Progress', 'dno': 'np', 'estimated_restored_time': '2021-04-18 04:15', 'incident_id': 'INCD-172392-A', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'WF14 9DL': {'class': 'models.MapDataLocation', 'lat': 53.6795, 'lng': -1.71197}}, 'received_time': '2021-04-18 01:12'}, 'geometry': {'type': 'Point', 'coordinates': [-1.712198, 53.67976]}}, {'type': 'Feature', 'properties': {'description': 'DNO Energisation check Awaiting', 'dno': 'np', 'estimated_restored_time': '2021-04-18 05:00', 'incident_id': 'INCD-172393-A', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'S2 1JW': {'class': 'models.MapDataLocation', 'lat': 53.3651, 'lng': -1.42538}}, 'received_time': '2021-04-18 01:49'}, 'geometry': {'type': 'Point', 'coordinates': [-1.425446, 53.364924]}}, {'type': 'Feature', 'properties': {'description': 'Unknown P2 In Progress', 'dno': 'np', 'estimated_restored_time': '2021-04-18 05:00', 'incident_id': 'INCD-172395-A', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'TS20 2NW': {'class': 'models.MapDataLocation', 'lat': 54.5816, 'lng': -1.31632}, 'TS20 2XL': {'class': 'models.MapDataLocation', 'lat': 54.5819, 'lng': -1.31825}, 'TS20 2XH': {'class': 'models.MapDataLocation', 'lat': 54.5818, 'lng': -1.31931}, 'TS20 2NQ': {'class': 'models.MapDataLocation', 'lat': 54.5823, 'lng': -1.31665}, 'TS20 2XJ': {'class': 'models.MapDataLocation', 'lat': 54.5815, 'lng': -1.3185}, 'TS20 2LQ': {'class': 'models.MapDataLocation', 'lat': 54.5818, 'lng': -1.31576}, 'TS20 2LG': {'class': 'models.MapDataLocation', 'lat': 54.582, 'lng': -1.31526}, 'TS20 2LE': {'class': 'models.MapDataLocation', 'lat': 54.5824, 'lng': -1.31598}, 'TS20 2LF': {'class': 'models.MapDataLocation', 'lat': 54.5823, 'lng': -1.31471}, 'TS20 2NL': {'class': 'models.MapDataLocation', 'lat': 54.5827, 'lng': -1.31554}, 'TS20 2LJ': {'class': 'models.MapDataLocation', 'lat': 54.582, 'lng': -1.31705}, 'TS20 2NH': {'class': 'models.MapDataLocation', 'lat': 54.5825, 'lng': -1.31635}, 'TS20 2NE': {'class': 'models.MapDataLocation', 'lat': 54.5834, 'lng': -1.31898}, 'TS20 2ND': {'class': 'models.MapDataLocation', 'lat': 54.582, 'lng': -1.31755}, 'TS20 2XY': {'class': 'models.MapDataLocation', 'lat': 54.5808, 'lng': -1.31732}, 'TS20 2XZ': {'class': 'models.MapDataLocation', 'lat': 54.5807, 'lng': -1.31836}}, 'received_time': '2021-04-18 01:50'}, 'geometry': {'type': 'Point', 'coordinates': [-1.317006, 54.5819826875]}}, {'type': 'Feature', 'properties': {'description': 'Unknown P2 In Progress', 'dno': 'np', 'estimated_restored_time': '2021-04-18 05:00', 'incident_id': 'INCD-172398-A', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'SR4 7DQ': {'class': 'models.MapDataLocation', 'lat': 54.9037, 'lng': -1.40334}, 'SR4 7DH': {'class': 'models.MapDataLocation', 'lat': 54.904, 'lng': -1.40366}, 'SR4 7DJ': {'class': 'models.MapDataLocation', 'lat': 54.9033, 'lng': -1.40312}, 'SR4 7DX': {'class': 'models.MapDataLocation', 'lat': 54.9034, 'lng': -1.40267}}, 'received_time': '2021-04-18 01:52'}, 'geometry': {'type': 'Point', 'coordinates': [-1.403345, 54.903602750000005]}}, {'type': 'Feature', 'properties': {'description': 'We need to temporarily turn the power off to carry out maintenance on our network in the area. The scheduled work has been cancelled and is no longer taking place today', 'dno': 'np', 'estimated_restored_time': '2021-04-18 22:00', 'incident_id': 'PPC039363', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'DN41 8DW': {'class': 'models.MapDataLocation', 'lat': 53.6083, 'lng': -0.172296}, 'DN41 8DL': {'class': 'models.MapDataLocation', 'lat': 53.6088, 'lng': -0.171807}, 'DN41 8FD': {'class': 'models.MapDataLocation', 'lat': 53.6065, 'lng': -0.180157}, 'DN4 5NU': {'class': 'models.MapDataLocation', 'lat': 53.5082, 'lng': -1.12161}, 'DN41 8TH': {'class': 'models.MapDataLocation', 'lat': 53.6052, 'lng': -0.181212}}, 'received_time': '2021-04-18 17:00'}, 'geometry': {'type': 'Point', 'coordinates': [-0.36565339999999996, 53.587383]}}, {'type': 'Feature', 'properties': {'description': 'We need to temporarily turn the power off to carry out replacement of poles that support our overhead power lines in the area. Work is scheduled to start', 'dno': 'np', 'estimated_restored_time': '2021-04-18 14:30', 'incident_id': 'PPC039606', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'HX3 9TF': {'class': 'models.MapDataLocation', 'lat': 53.7177, 'lng': -1.82668}}, 'received_time': '2021-04-18 08:30'}, 'geometry': {'type': 'Point', 'coordinates': [-1.826674, 53.717724]}}, {'type': 'Feature', 'properties': {'description': 'We need to temporarily turn the power off to carry out replacement work on our overhead power lines in the area. Work is scheduled to start', 'dno': 'np', 'estimated_restored_time': '2021-04-18 14:00', 'incident_id': 'PPC039748', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'NE47 7HE': {'class': 'models.MapDataLocation', 'lat': 54.9894, 'lng': -2.39113}, 'NE47 7AW': {'class': 'models.MapDataLocation', 'lat': 55.0007, 'lng': -2.38799}, 'NE47 7JW': {'class': 'models.MapDataLocation', 'lat': 54.9907, 'lng': -2.3735}, 'NE47 7AL': {'class': 'models.MapDataLocation', 'lat': 54.9974, 'lng': -2.37973}, 'NE47 7AN': {'class': 'models.MapDataLocation', 'lat': 54.9955, 'lng': -2.39183}}, 'received_time': '2021-04-18 08:00'}, 'geometry': {'type': 'Point', 'coordinates': [-2.3842884, 54.99502739999999]}}, {'type': 'Feature', 'properties': {'description': 'We need to temporarily turn the power off to carry out replacement work at a substation in the area. Work is scheduled to start', 'dno': 'np', 'estimated_restored_time': '2021-04-18 14:00', 'incident_id': 'PPC039968', 'incident_url': 'https://www.northernpowergrid.com/power-cuts', 'postcodes_impacted': {'NE47 7HD': {'class': 'models.MapDataLocation', 'lat': 54.9868, 'lng': -2.37724}}, 'received_time': '2021-04-18 07:30'}, 'geometry': {'type': 'Point', 'coordinates': [-2.377239, 54.986748]}}, {'type': 'Feature', 'properties': {'description': 'The power cut in your area has been caused by an unexpected incident with the underground cable that provides electricity to your property.', 'dno': 'enw', 'estimated_restored_time': '2021-04-18 12:30', 'incident_id': '60508633', 'incident_url': 'https://www.enwl.co.uk/power-cuts/power-cuts-power-cuts-live-power-cut-information-fault-list/fault-list', 'postcodes_impacted': ['LA3 2BP', 'LA3 2BU', 'LA3 2DF', 'LA3 2DN', 'LA3 2DQ', 'LA3 2DR', 'LA3 2DS', 'LA3 2DY', 'LA3 2JH'], 'received_time': '2021-04-17 16:41'}, 'geometry': {'type': 'Point', 'coordinates': [-2.890340777777778, 54.048605888888886]}}]}

var geoJson = new L.geoJSON(geojsonFeature, {
  onEachFeature: function (feature, layer) {
    layer.bindPopup('<p>'+feature.properties.description+'</p><p>Received time: '+feature.properties.received_time+'</p><p>Estimated restored time: '+feature.properties.estimated_restored_time+'</p><p><a href="'+feature.properties.incident_url+'" target="_blank">Further details</p>');
    layer.setIcon(boltIcon);
  }
}).addTo(mymap);
});